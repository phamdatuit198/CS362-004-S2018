        -:    0:Source:randomtestcard1.c
        -:    0:Graph:randomtestcard1.gcno
        -:    0:Data:randomtestcard1.gcda
        -:    0:Runs:1
        -:    0:Programs:1
        -:    1:/*
        -:    2:	Author: Dat Pham
        -:    3:	CS 362
        -:    4:	Spring 2018
        -:    5:	
        -:    6:*/
        -:    7:#include <stdio.h>
        -:    8:#include <string.h>
        -:    9:#include <stdlib.h>
        -:   10:#include <assert.h>
        -:   11:#include <time.h>
        -:   12:#include <math.h>
        -:   13:
        -:   14:#include "dominion.h"
        -:   15:#include "dominion_helpers.h"
        -:   16:#include "rngs.h"
        -:   17:
        -:   18:
        -:   19:// fail counter variables
        -:   20:
        -:   21:int failCardEffect = 0;
        -:   22:int failDiscardCard = 0;
        -:   23:int failDrawCard = 0;
        -:   24:int failDeckHandCount = 0;
        -:   25:int failNumberBuy = 0;
        -:   26:int failDeckHandCount2 = 0;
        -:   27:
        -:   28:
    10000:   29:void checkCard(struct gameState *state,int player) {
        -:   30:  
        -:   31:    struct gameState tempState;
        -:   32:	int drawCard1,drawCard2,drawCard3,drawCard4;
        -:   33:	int result;
    10000:   34:	int i=0;
        -:   35:    // save state to tempState
    10000:   36:    memcpy(&tempState,state,sizeof(struct gameState));
        -:   37:
        -:   38:    // check cardEffect
    10000:   39:    result = cardEffect(council_room,0,0,0,state,0,0);
    10000:   40:	if(result)
    #####:   41:		failCardEffect++;
        -:   42:	
        -:   43:	 //discardCard
    10000:   44:	result = discardCard(0,player,&tempState,0);
    10000:   45:	if(result)
    #####:   46:		failDiscardCard++;
        -:   47:	
        -:   48:    // call draw card 4 times
    10000:   49:    drawCard1 = drawCard(player,&tempState);
    10000:   50:    drawCard2 = drawCard(player,&tempState);
    10000:   51:    drawCard3 = drawCard(player,&tempState);
    10000:   52:    drawCard4 = drawCard(player,&tempState);
        -:   53:	
        -:   54:	// check drawcard failed
    10000:   55:	if(tempState.deckCount[player] != 0){
     9986:   56:		if (drawCard1 == -1) {
    #####:   57:			failDrawCard++;
        -:   58:		}
     9986:   59:		if (drawCard2 == -1) {
    #####:   60:			failDrawCard++;
        -:   61:		}
     9986:   62:		if (drawCard3 == -1) {
    #####:   63:			failDrawCard++;
        -:   64:		}
     9986:   65:		if (drawCard4 == -1) {
    #####:   66:			failDrawCard++;
        -:   67:		}
        -:   68:	}
        -:   69:	
        -:   70:	//check numBuys
    10000:   71:    tempState.numBuys++;
    10000:   72:	if (tempState.numBuys != state->numBuys) {
        8:   73:        failNumberBuy++;
        -:   74:    }
        -:   75:
        -:   76:    // check hand and deck have amount don't same
    10000:   77:    if(!(state->handCount[player]==tempState.handCount[player] 
    #####:   78:		&&state->deckCount[player] == tempState.deckCount[player]))
    10000:   79:			failDeckHandCount++;
        -:   80:
        -:   81:
        -:   82:    // check another player with hand and deck counts don't match
    40029:   83:    for (i = 0; i < tempState.numPlayers; i++) {
    30029:   84:        if (i != player) {
    20029:   85:            if (!(state->handCount[i] == tempState.handCount[i] &&
    #####:   86:                  state->deckCount[i] == tempState.deckCount[i])) {
    20029:   87:                      failDeckHandCount2++;
        -:   88:            }
        -:   89:        }
        -:   90:    }
        -:   91:	
        -:   92:	// check drawCard with another people
    40029:   93:    for (i = 0; i < tempState.numPlayers; i++) {
    30029:   94:        if (i != player) {
    20029:   95:            result = drawCard(i,&tempState);
        -:   96:           
    20029:   97:            if (result == -1 && tempState.deckCount[i] != 0)
    #####:   98:                failDrawCard++;
        -:   99:        }
        -:  100:    }
        -:  101:	
    10000:  102:}
        -:  103:
        -:  104:
        1:  105:int main () {
        -:  106:	
        1:  107:	int loop = 10000;
        -:  108:    int i, n, player;
        1:  109:	int total = 0;
        1:  110:	int countDeck = 0;
        1:  111:	int countHand = 0;
        1:  112:	int countDiscard = 0;
        -:  113:    struct gameState state;
        1:  114:	int numberOfPlayers[] = {2,3,4};
        1:  115:    srand(time(NULL));
        -:  116:	
        1:  117:	printf("\n----------- RANDOM TEST ------------");
        1:  118:    printf("\n Testing function council_roomCard()");
        1:  119:    printf("\n------------------------------------");
        -:  120:	
        -:  121:
        -:  122:    // random the game state
    10001:  123:    for (n = 0; n < loop; n++) {
263010000:  124:        for (i = 0; i < sizeof(struct gameState); i++)
263000000:  125:            ((char*)&state)[i] = floor(Random() * 256);
        -:  126:        	
        -:  127:        // random select values
    10000:  128:        state.numPlayers = numberOfPlayers[rand() % 3];
    10000:  129:        state.numBuys = 1;
    10000:  130:        state.playedCardCount = floor(Random() * (MAX_DECK-1));
    10000:  131:        player = state.numPlayers - 2;
    10000:  132:        state.whoseTurn = player;
        -:  133:		
    10000:  134:		countDeck 	 = floor(Random() * MAX_DECK);
    10000:  135:        countHand 	 = floor(Random() * MAX_HAND);
    10000:  136:        countDiscard = floor(Random() * MAX_DECK);
    40029:  137:        for (i = 0; i < state.numPlayers; i++) {
    30029:  138:            state.deckCount[i] 	  = countDeck;
    30029:  139:            state.handCount[i]    = countHand;
    30029:  140:            state.discardCount[i] = countDiscard;
        -:  141:        }
        -:  142:        // call the check function
    10000:  143:        checkCard(&state,player);
        -:  144:    }
        -:  145: 
        1:  146:    total = failCardEffect + failDrawCard + failDiscardCard + failDeckHandCount + failNumberBuy + failDeckHandCount2;
        -:  147:       
        1:  148:	printf("\n\n\n----- RESULT RANDOM TEST---------\n");
        1:  149:	printf("\nTotal FAILED: %d",total);
        1:  150:	printf("\nThe amount failed failed drawCard(): %d",failDrawCard);
        1:  151:	printf("\nThe amount failed failed cardEffect() failed: %d",failCardEffect);
        1:  152:	printf("\nThe amount failed failed discardCard() failed: %d",failDiscardCard);
        1:  153:	printf("\nCount numBuy don't match: %d",failNumberBuy);
        1:  154:	printf("\nCount hand and desk don't match: %d",failDeckHandCount);
        1:  155:	printf("\nCount hand and desk don't match from another player: %d\n",failDeckHandCount2);
        1:  156:    return 0;
        -:  157:}
